; Listing generated by Microsoft (R) Optimizing Compiler Version 14.00.50727.42 

	TITLE	c:\Documents and Settings\SudaNix\Desktop\eqraOS\eqraOS-doc\examples\ch4\pmm\core\kernel\main.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

CONST	SEGMENT
$SG2725	DB	'eqraOS kernel executed', 0aH, 00H
$SG2732	DB	'b1 allocataed 1 block at 0x%x: ', 0aH, 00H
	ORG $+3
$SG2733	DB	'b2 allocataed 2 blocks at 0x%x: ', 0aH, 00H
	ORG $+2
$SG2735	DB	'b1 re-allocataed at 0x%x: ', 0aH, 00H
	ORG $+4
$SG2738	DB	'                                  eqraOS v0.1           '
	DB	'                        ', 00H
	ORG $+7
$SG2739	DB	'                                                        '
	DB	'                        ', 00H
CONST	ENDS
PUBLIC	?pmm_demo@@YAXXZ				; pmm_demo
EXTRN	?pmm_deallocs@@YAXPAXI@Z:PROC			; pmm_deallocs
EXTRN	?pmm_dealloc@@YAXPAX@Z:PROC			; pmm_dealloc
EXTRN	?kprintf@@YAHPBDZZ:PROC				; kprintf
EXTRN	?pmm_allocs@@YAPAXI@Z:PROC			; pmm_allocs
EXTRN	?pmm_alloc@@YAPAXXZ:PROC			; pmm_alloc
EXTRN	?kset_color@@YAII@Z:PROC			; kset_color
; Function compile flags: /Ogtpy
; File c:\documents and settings\sudanix\desktop\eqraos\eqraos-doc\examples\ch4\pmm\core\kernel\main.cpp
_TEXT	SEGMENT
?pmm_demo@@YAXXZ PROC					; pmm_demo

; 59   : void pmm_demo() {

	push	esi
	push	edi

; 60   : 	
; 61   : 	kset_color(0x12);

	push	18					; 00000012H
	call	?kset_color@@YAII@Z			; kset_color

; 62   : 	
; 63   : 	uint32_t* b1 = (uint32_t*)pmm_alloc();

	call	?pmm_alloc@@YAPAXXZ			; pmm_alloc

; 64   : 	uint32_t* b2 = (uint32_t*)pmm_allocs(2);

	push	2
	mov	esi, eax
	call	?pmm_allocs@@YAPAXI@Z			; pmm_allocs

; 65   : 	
; 66   : 	kprintf("b1 allocataed 1 block at 0x%x: \n",b1);

	push	esi
	push	OFFSET $SG2732
	mov	edi, eax
	call	?kprintf@@YAHPBDZZ			; kprintf

; 67   : 	kprintf("b2 allocataed 2 blocks at 0x%x: \n",b2);

	push	edi
	push	OFFSET $SG2733
	call	?kprintf@@YAHPBDZZ			; kprintf

; 68   : 
; 69   : 	pmm_dealloc(b1);

	push	esi
	call	?pmm_dealloc@@YAXPAX@Z			; pmm_dealloc

; 70   : 	b1 = (uint32_t*)pmm_alloc();

	call	?pmm_alloc@@YAPAXXZ			; pmm_alloc
	mov	esi, eax

; 71   : 	kprintf("b1 re-allocataed at 0x%x: \n",b1);

	push	esi
	push	OFFSET $SG2735
	call	?kprintf@@YAHPBDZZ			; kprintf

; 72   : 	
; 73   : 	pmm_dealloc(b1);

	push	esi
	call	?pmm_dealloc@@YAXPAX@Z			; pmm_dealloc

; 74   : 	pmm_deallocs(b2,2);

	push	2
	push	edi
	call	?pmm_deallocs@@YAXPAXI@Z		; pmm_deallocs
	add	esp, 48					; 00000030H
	pop	edi
	pop	esi

; 75   : }

	ret	0
?pmm_demo@@YAXXZ ENDP					; pmm_demo
_TEXT	ENDS
PUBLIC	?eqraos_screen@@YAXXZ				; eqraos_screen
EXTRN	?kputs@@YAXPAD@Z:PROC				; kputs
EXTRN	?kgoto_xy@@YAXII@Z:PROC				; kgoto_xy
EXTRN	?kclear@@YAXG@Z:PROC				; kclear
; Function compile flags: /Ogtpy
_TEXT	SEGMENT
?eqraos_screen@@YAXXZ PROC				; eqraos_screen

; 78   : 	kclear(0x13);

	push	19					; 00000013H
	call	?kclear@@YAXG@Z				; kclear

; 79   : 	kgoto_xy(0,0);

	push	0
	push	0
	call	?kgoto_xy@@YAXII@Z			; kgoto_xy

; 80   : 	kset_color(0x3F);

	push	63					; 0000003fH
	call	?kset_color@@YAII@Z			; kset_color

; 81   : 	kputs("                                  eqraOS v0.1                                   ");

	push	OFFSET $SG2738
	call	?kputs@@YAXPAD@Z			; kputs

; 82   : 	//kgoto_xy(0,1);
; 83   : 	//kputs("                          Ahmad Essam [suda.nix@hotmail.com]                    ");
; 84   : 	
; 85   : 	kgoto_xy(0,24);

	push	24					; 00000018H
	push	0
	call	?kgoto_xy@@YAXII@Z			; kgoto_xy

; 86   : 	kset_color(0x3F);

	push	63					; 0000003fH
	call	?kset_color@@YAII@Z			; kset_color

; 87   : 	kputs("                                                                                ");

	push	OFFSET $SG2739
	call	?kputs@@YAXPAD@Z			; kputs

; 88   : 	
; 89   : 	kgoto_xy(0,3);

	push	3
	push	0
	call	?kgoto_xy@@YAXII@Z			; kgoto_xy
	add	esp, 44					; 0000002cH

; 90   : }

	ret	0
?eqraos_screen@@YAXXZ ENDP				; eqraos_screen
_TEXT	ENDS
PUBLIC	_main
EXTRN	?mem_info_blocks_stat@@YAXXZ:PROC		; mem_info_blocks_stat
EXTRN	?execption_init@@YAXXZ:PROC			; execption_init
EXTRN	?enable_irq@@YAXXZ:PROC				; enable_irq
EXTRN	?hal_init@@YAHXZ:PROC				; hal_init
EXTRN	?mem_info_dump_region@@YAXXZ:PROC		; mem_info_dump_region
EXTRN	?mem_info_dump_size@@YAXXZ:PROC			; mem_info_dump_size
EXTRN	?mem_info_init@@YAXPAUmultiboot_info@@@Z:PROC	; mem_info_init
; Function compile flags: /Ogtpy
_TEXT	SEGMENT
_boot_info$ = 8						; size = 4
_main	PROC

; 38   : 	mem_info_init(boot_info);

	mov	eax, DWORD PTR _boot_info$[esp-4]
	push	eax
	call	?mem_info_init@@YAXPAUmultiboot_info@@@Z ; mem_info_init

; 39   : 
; 40   : 	eqraos_screen();

	push	19					; 00000013H
	call	?kclear@@YAXG@Z				; kclear
	push	0
	push	0
	call	?kgoto_xy@@YAXII@Z			; kgoto_xy
	push	63					; 0000003fH
	call	?kset_color@@YAII@Z			; kset_color
	push	OFFSET $SG2738
	call	?kputs@@YAXPAD@Z			; kputs
	push	24					; 00000018H
	push	0
	call	?kgoto_xy@@YAXII@Z			; kgoto_xy
	push	63					; 0000003fH
	call	?kset_color@@YAII@Z			; kset_color
	push	OFFSET $SG2739
	call	?kputs@@YAXPAD@Z			; kputs
	push	3
	push	0
	call	?kgoto_xy@@YAXII@Z			; kgoto_xy

; 41   : 
; 42   : 	kset_color(GRAY_ON_BLUE);

	push	23					; 00000017H
	call	?kset_color@@YAII@Z			; kset_color

; 43   : 	kputs("eqraOS kernel executed\n");

	push	OFFSET $SG2725
	call	?kputs@@YAXPAD@Z			; kputs
	add	esp, 56					; 00000038H

; 44   : 
; 45   : 	mem_info_dump_size();

	call	?mem_info_dump_size@@YAXXZ		; mem_info_dump_size

; 46   : 	mem_info_dump_region();

	call	?mem_info_dump_region@@YAXXZ		; mem_info_dump_region

; 47   : 	hal_init();

	call	?hal_init@@YAHXZ			; hal_init

; 48   : 	enable_irq();

	call	?enable_irq@@YAXXZ			; enable_irq

; 49   : 	execption_init();

	call	?execption_init@@YAXXZ			; execption_init

; 50   : 	mem_info_blocks_stat();

	call	?mem_info_blocks_stat@@YAXXZ		; mem_info_blocks_stat

; 51   : 
; 52   : 	// allocate and deallocate demos.
; 53   : 	pmm_demo();

	call	?pmm_demo@@YAXXZ			; pmm_demo

; 54   : 	
; 55   : 	return 0;

	xor	eax, eax

; 56   : }

	ret	0
_main	ENDP
_TEXT	ENDS
END
